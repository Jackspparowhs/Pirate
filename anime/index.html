<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Category — PirateRuler</title>
  <meta name="description" content="PirateRuler — category listing template" />
  <style>
    /* Simple dark theme + responsive layout */
    :root{
      --bg:#070707; --panel:#0f0f11; --muted:#9aa3ad; --accent:#00e6a8; --card:#121214;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(180deg,#050506 0%, #07070a 100%);color:#e6eef3;-webkit-font-smoothing:antialiased}
    .app{display:flex;min-height:100vh;}
    .sidebar{width:300px;max-width:32%;min-width:220px;background:var(--panel);padding:20px;box-shadow:0 6px 30px rgba(0,0,0,.6);}
    .sidebar .logo{font-weight:700;color:var(--accent);font-size:18px;margin-bottom:12px}
    .sidebar .desc{color:var(--muted);font-size:13px;margin-bottom:18px}
    .btn{display:flex;gap:10px;align-items:center;padding:10px 12px;border-radius:10px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.03);cursor:pointer;margin-bottom:8px}
    .btn:hover{background:rgba(255,255,255,0.02);transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(90deg, rgba(0,230,168,0.08), rgba(0,179,255,0.02));border-color:rgba(0,230,168,0.12)}
    .sidebar h3{margin:18px 0 8px;color:#cfeee0;font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    .content{flex:1;padding:20px;display:flex;flex-direction:column;gap:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .search{flex:1;display:flex;gap:8px}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:#0b0b0d;color:#eaf7ef}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}
    .card{background:var(--card);border-radius:10px;overflow:hidden;display:flex;flex-direction:column;min-height:220px}
    .poster{height:170px;background:#0a0a0a;background-size:cover;background-position:center}
    .meta{padding:10px;display:flex;flex-direction:column;gap:6px}
    .meta h4{margin:0;font-size:14px}
    .meta p{margin:0;color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;margin-top:auto}
    .tag{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:12px;color:var(--muted)}
    .loader{padding:40px;text-align:center;color:var(--muted)}
    @media (max-width:900px){.sidebar{display:none}.app{flex-direction:column}.content{padding:12px}}
  </style>
</head>
<body>
  <div class="app">
    <!-- ===== Sidebar (configurable UI) ===== -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">PirateRuler • Category</div>
      <div class="desc">Curated list — use the buttons to fetch Top / Trending / New items. Configure APIs in the template top.</div>

      <div>
        <button class="btn primary" data-action="top10">Top 10</button>
        <button class="btn" data-action="trending">Trending</button>
        <button class="btn" data-action="latest">Latest</button>
        <button class="btn" data-action="random">Random</button>
        <button class="btn" data-action="by-genre">By Genre</button>
      </div>

      <h3>Quick Filters</h3>
      <div>
        <button class="btn" data-action="filter-popular">Most Popular</button>
        <button class="btn" data-action="filter-ongoing">Ongoing</button>
        <button class="btn" data-action="filter-completed">Completed</button>
      </div>

      <h3>Utility</h3>
      <div class="small">You can link to your main site, contact, DMCA, privacy pages below.</div>
      <div style="margin-top:12px;">
        <button class="btn" id="open-site">Open PirateRuler.com</button>
        <button class="btn" id="open-contact">Contact / DMCA</button>
      </div>

      <div style="margin-top:24px">
        <div class="small">API Status: <span id="api-status">—</span></div>
      </div>
    </aside>

    <!-- ===== Main content ===== -->
    <main class="content">
      <div class="topbar">
        <div style="display:flex;gap:12px;align-items:center;">
          <h2 id="page-title">Category</h2>
          <div class="tag" id="current-action">Top 10</div>
        </div>

        <div class="search">
          <input id="search-input" placeholder="Search in this category..." />
          <button class="btn" id="search-btn">Search</button>
        </div>
      </div>

      <section id="results-area">
        <div id="message" class="loader">Click a button on the left to load content.</div>
        <div class="grid" id="grid" style="display:none"></div>
      </section>

      <div style="display:flex;justify-content:center;gap:10px">
        <button class="btn" id="load-more" style="display:none">Load more</button>
      </div>
    </main>
  </div>

  <script>
    /*************************************************************************
     * CONFIG: change these values for each category file (anime/manga/etc.)
     * - folder approach: place this same file in /anime/index.html and update
     *   the apiBase and endpoints for anime.
     *
     * Example endpoints shape:
     *   apiBase: "https://api.myservice.com"
     *   endpoints.top10 => "/anime/top10"
     *
     * NOTE: your API must allow CORS or use a server proxy.
     *************************************************************************/
    const CATEGORY_CONFIG = {
      name: "Anime",                 // visible category title
      apiBase: "https://api.example.com", // <-- CHANGE per category
      endpoints: {
        top10: "/v1/anime/top10",         // GET (returns array)
        trending: "/v1/anime/trending",
        latest: "/v1/anime/latest",
        random: "/v1/anime/random",
        byGenre: "/v1/anime/genre/",     // append genre name
        search: "/v1/anime/search?q=",   // append query
        details: "/v1/anime/details/"    // append id (optional)
      },
      // image placeholder (if item has no poster)
      placeholderPoster: "https://via.placeholder.com/400x600?text=No+Image"
    };

    // small helper for building full URLs
    function buildUrl(path) {
      if (!path) return null;
      return (CATEGORY_CONFIG.apiBase.replace(/\/$/, "") + path);
    }

    // basic DOM refs
    const grid = document.getElementById("grid");
    const msg = document.getElementById("message");
    const pageTitle = document.getElementById("page-title");
    const currentAction = document.getElementById("current-action");
    const apiStatus = document.getElementById("api-status");
    const loadMoreBtn = document.getElementById("load-more");

    document.addEventListener("DOMContentLoaded", () => {
      pageTitle.textContent = CATEGORY_CONFIG.name;
      attachSidebar();
      checkApi();
    });

    // Attach click handlers to sidebar buttons (delegation)
    function attachSidebar(){
      document.querySelectorAll("[data-action]").forEach(btn=>{
        btn.addEventListener("click", () => handleAction(btn.dataset.action));
      });
      document.getElementById("open-site").addEventListener("click", () => window.open("https://pirateruler.com", "_blank"));
      document.getElementById("open-contact").addEventListener("click", () => window.open("https://pirateruler.com/post/contact.html", "_blank"));
      document.getElementById("search-btn").addEventListener("click", doSearch);
      document.getElementById("search-input").addEventListener("keydown", (e)=>{ if(e.key==="Enter") doSearch(); });
    }

    // Basic API status check (GET root or top10)
    async function checkApi(){
      const url = buildUrl(CATEGORY_CONFIG.endpoints.top10);
      if(!url){apiStatus.textContent="No endpoint"; return;}
      try{
        const r = await fetch(url, {method:"GET"});
        apiStatus.textContent = (r.ok ? "OK" : "Error");
      }catch(e){
        apiStatus.textContent = "Offline / CORS";
      }
    }

    // Unified action handler
    let page = 1;
    let lastAction = null;
    async function handleAction(action){
      lastAction = action;
      page = 1;
      currentAction.textContent = action.replace("-", " ");
      clearGrid();
      showMessage("Loading...");
      try{
        let url;
        switch(action){
          case "top10":
            url = buildUrl(CATEGORY_CONFIG.endpoints.top10);
            break;
          case "trending":
            url = buildUrl(CATEGORY_CONFIG.endpoints.trending);
            break;
          case "latest":
            url = buildUrl(CATEGORY_CONFIG.endpoints.latest) + `?page=${page}`;
            break;
          case "random":
            url = buildUrl(CATEGORY_CONFIG.endpoints.random);
            break;
          case "by-genre":
            // for by-genre we open a prompt to choose genre (simple)
            const g = prompt("Enter genre (e.g. action, romance):");
            if(!g) return showMessage("Genre cancelled");
            url = buildUrl(CATEGORY_CONFIG.endpoints.byGenre + encodeURIComponent(g));
            break;
          case "filter-popular":
            url = buildUrl(CATEGORY_CONFIG.endpoints.trending);
            break;
          case "filter-ongoing":
            url = buildUrl(CATEGORY_CONFIG.endpoints.latest) + `?status=ongoing&page=${page}`;
            break;
          case "filter-completed":
            url = buildUrl(CATEGORY_CONFIG.endpoints.latest) + `?status=completed&page=${page}`;
            break;
          default:
            return showMessage("Unknown action");
        }

        if(!url) return showMessage("No URL configured for this action");

        const res = await fetch(url);
        if(!res.ok) throw new Error("Network error");
        const data = await res.json();
        const items = normalizeItems(data);
        if(items.length === 0) return showMessage("No results");
        renderGrid(items);
        showGrid();
        // show load more if the endpoint supports pagination (simple heuristic)
        loadMoreBtn.style.display = url.includes("page=") ? "inline-flex" : "none";
        loadMoreBtn.onclick = ()=> loadMore(url);
      }catch(err){
        console.error(err);
        showMessage("Failed to load — check console and CORS.");
      }
    }

    // Search
    async function doSearch(){
      const q = document.getElementById("search-input").value.trim();
      if(!q) return;
      clearGrid();
      showMessage("Searching...");
      const url = buildUrl(CATEGORY_CONFIG.endpoints.search + encodeURIComponent(q));
      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error("Search failed");
        const data = await res.json();
        const items = normalizeItems(data);
        if(items.length===0) return showMessage("No results");
        renderGrid(items);
        showGrid();
      }catch(err){
        console.error(err);
        showMessage("Search error — check console.");
      }
    }

    // Load more (simple pagination append)
    async function loadMore(baseUrl){
      page++;
      // try to replace page param or append it
      let url = baseUrl;
      if(!/page=/.test(url)) url += (url.includes("?") ? "&" : "?") + "page=" + page;
      else url = url.replace(/page=\d+/,"page="+page);
      showMessage("Loading more...");
      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error("Load more failed");
        const data = await res.json();
        const items = normalizeItems(data);
        if(items.length===0) { loadMoreBtn.style.display="none"; showMessage("No more results"); return; }
        appendGrid(items);
        showGrid();
      }catch(err){
        console.error(err);
        showMessage("Failed to load more");
      }
    }

    // Normalize items — adapt to the structure your API returns
    function normalizeItems(raw){
      // If API returns {data: [...]} or direct array
      let list = [];
      if(Array.isArray(raw)) list = raw;
      else if(raw && Array.isArray(raw.data)) list = raw.data;
      else if(raw && raw.results && Array.isArray(raw.results)) list = raw.results;
      // Map to a known shape: {id,title,poster,subtitle}
      return list.map(i => ({
        id: i.id || i.slug || i.url || (i.title && i.title.toLowerCase().replace(/\s+/g,"-")),
        title: i.title || i.name || i.label || "Untitled",
        poster: i.poster || i.image || i.thumbnail || CATEGORY_CONFIG.placeholderPoster,
        subtitle: i.subtitle || i.year || i.meta || ""
      }));
    }

    // Render helpers
    function clearGrid(){ grid.innerHTML = ""; grid.style.display="none"; loadMoreBtn.style.display="none"; }
    function showMessage(text){ msg.style.display="block"; msg.textContent = text; grid.style.display="none"; }
    function showGrid(){ msg.style.display="none"; grid.style.display="grid"; }
    function renderGrid(items){
      grid.innerHTML = items.map(tplCard).join("");
      // attach click delegates afterwards
      Array.from(grid.querySelectorAll(".card")).forEach(el=>{
        el.addEventListener("click", ()=> {
          const id = el.dataset.id;
          // open details in new tab (adjust path if you implement details pages)
          const detailsUrl = CATEGORY_CONFIG.apiBase + "/watch/" + id;
          window.open(detailsUrl, "_blank");
        });
      });
    }
    function appendGrid(items){
      const html = items.map(tplCard).join("");
      grid.insertAdjacentHTML("beforeend", html);
    }
    function tplCard(item){
      return `
        <article class="card" data-id="${escapeHtml(item.id)}" role="button" tabindex="0">
          <div class="poster" style="background-image:url('${escapeHtml(item.poster)}')"></div>
          <div class="meta">
            <h4>${escapeHtml(item.title)}</h4>
            <p>${escapeHtml(item.subtitle || "")}</p>
            <div class="actions">
              <span class="tag">View</span>
              <span class="tag">Details</span>
            </div>
          </div>
        </article>
      `;
    }

    function escapeHtml(s){ if(!s) return ""; return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  </script>
</body>
</html>
